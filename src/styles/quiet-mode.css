/* ========================================
   QUIET MODE V2 - SENSORY-AWARE DESIGN

   ⚠️ CRITICAL RULE (Phase 8):
   - Quiet Mode affects SPACING and ANIMATIONS only
   - NO color overrides (colors are Dark Mode's job)
   - This ensures Quiet Mode + Dark Mode work correctly together

   QUIET MODE V2 SUB-TOGGLES:
   - data-quiet-visuals: Calm visuals (motion, spacing, urgency)
   - data-quiet-writing: Writing focus mode (distraction-free)
   - data-quiet-metrics: Hide engagement metrics (likes, counts)

   Main variables are defined in variables.css
   ======================================== */

/* ========================================
   QUIET MODE V2: TOKEN DEFINITIONS
   ======================================== */

[data-quiet="true"] {
  /* Spacing & Rhythm */
  --space-2: 10px;
  --space-3: 16px;
  --space-4: 22px;
  --space-5: 30px;
  --space-6: 40px;

  --line-height-body: 1.7;
  --line-height-writing: 1.85;

  /* Motion - faster, subtler transitions */
  --motion-fast: 120ms;
  --motion-normal: 180ms;
  --motion-ease: cubic-bezier(0.2, 0, 0, 1);

  /* Emphasis - reduced visual weight */
  --opacity-muted: 0.55;
  --opacity-soft: 0.75;

  /* Border for quiet surfaces */
  --border-subtle: rgba(127, 127, 127, 0.15);
}

/* ========================================
   SMOOTH TRANSITIONS
   Animate theme changes for pleasant UX
   ======================================== */

html {
  transition: background-color 0.3s ease-in-out;
}

/* Apply transition to common elements when quiet mode toggles */
[data-quiet="true"] *,
[data-quiet-mode="true"] * {
  transition:
    background-color 0.3s ease-in-out,
    color 0.3s ease-in-out,
    border-color 0.3s ease-in-out,
    box-shadow 0.3s ease-in-out;
}

/* ========================================
   QUIET MODE: REDUCED MOTION
   Disable non-essential animations
   ======================================== */

[data-quiet="true"],
[data-quiet-mode="true"] {
  /* Reduce animation speed globally */
  --animation-duration: 0.1s;
  --transition-duration: 0.1s;
}

/* Disable decorative animations in Quiet Mode */
[data-quiet="true"] .animated,
[data-quiet="true"] .pulse,
[data-quiet="true"] .bounce,
[data-quiet="true"] .shake,
[data-quiet-mode="true"] .animated,
[data-quiet-mode="true"] .pulse,
[data-quiet-mode="true"] .bounce,
[data-quiet-mode="true"] .shake {
  animation: none !important;
}

/* Reduce hover effects */
[data-quiet="true"] button:hover,
[data-quiet="true"] a:hover,
[data-quiet-mode="true"] button:hover,
[data-quiet-mode="true"] a:hover {
  transform: none;
}

/* Calm button states - no scale transforms */
[data-quiet="true"] .btn-join:hover,
[data-quiet="true"] .btn-leave:hover,
[data-quiet="true"] .join-btn:hover,
[data-quiet-mode="true"] .btn-join:hover,
[data-quiet-mode="true"] .btn-leave:hover,
[data-quiet-mode="true"] .join-btn:hover {
  transform: none;
  box-shadow: none;
}

/* ========================================
   QUIET MODE: SUBTLE FOCUS STATES
   Reduced emphasis for calm browsing
   ======================================== */

[data-quiet="true"] :focus-visible,
[data-quiet-mode="true"] :focus-visible {
  outline-width: 1px;
  outline-offset: 1px;
  box-shadow: none;
}

/* ========================================
   QUIET MODE: NO SURPRISE UI CHANGES
   Predictable, calm interface
   ======================================== */

/* Don't animate notification badges */
[data-quiet="true"] .notification-badge,
[data-quiet="true"] .unread-badge,
[data-quiet-mode="true"] .notification-badge,
[data-quiet-mode="true"] .unread-badge {
  animation: none;
}

/* Softer toast notifications */
[data-quiet="true"] .toast,
[data-quiet-mode="true"] .toast {
  animation: none;
  opacity: 0.9;
}

/* ========================================
   PREFERS-REDUCED-MOTION SYNC
   Honor system preference
   ======================================== */

@media (prefers-reduced-motion: reduce) {
  [data-quiet="true"],
  [data-quiet-mode="true"] {
    /* Already reduced, ensure it stays that way */
  }

  /* Force reduced motion for all users who prefer it */
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
}

/* ==================================================
   TABLET POLISH PASS (768px–1023px)
   ================================================== */

@media (min-width: 768px) and (max-width: 1023px) {

  /* Global spacing rhythm */
  .container,
  .page,
  .layout {
    padding-left: 20px;
    padding-right: 20px;
  }

  /* Cards & surfaces */
  .card,
  .panel,
  .surface {
    border-radius: 14px;
    box-shadow: none;
    border: 1px solid rgba(255,255,255,0.06);
  }

  /* Messages */
  .messages-layout {
    gap: 16px;
  }

  .message-bubble {
    max-width: 82%;
    padding: 10px 14px;
    border-radius: 16px;
  }

  /* Groups */
  .group-card {
    padding: 16px;
  }

  /* Profile header */
  .profile-header {
    padding: 20px;
  }

  .profile-avatar {
    width: 88px;
    height: 88px;
  }
}

/* ==================================================
   QUIET MODE — SPACING & ANIMATION ONLY

   ⚠️ CRITICAL: Phase 8 refactor
   - Quiet Mode affects SPACING and ANIMATIONS only
   - NO color overrides (colors are Dark Mode's responsibility)
   - This ensures Quiet Mode + Dark Mode work together correctly
   ================================================== */

/* ========================================
   QUIET MODE: SPACING TOKENS
   Increase vertical rhythm for calmer reading
   ======================================== */

[data-quiet="true"],
[data-quiet-mode="true"] {
  /* Increase spacing for breathing room */
  --quiet-space-multiplier: 1.25;

  /* Card/Surface spacing - more generous */
  --space-card-padding: calc(var(--space-4) * 1.25);

  /* List item gaps - more vertical rhythm */
  --space-list-gap: calc(var(--space-4) * 1.25);

  /* Reduced shadow intensity */
  --shadow-quiet: none;
}

/* ========================================
   QUIET MODE: LAYOUT SPACING ADJUSTMENTS
   ======================================== */

[data-quiet="true"] .feed-main,
[data-quiet-mode="true"] .feed-main {
  gap: calc(var(--space-md) * 1.25);
}

[data-quiet="true"] .post-card,
[data-quiet-mode="true"] .post-card {
  padding: calc(var(--space-4) * 1.25);
  box-shadow: var(--shadow-quiet, none);
}

[data-quiet="true"] .messages-list,
[data-quiet-mode="true"] .messages-list {
  gap: calc(var(--space-3) * 1.25);
}

[data-quiet="true"] .message-bubble,
[data-quiet-mode="true"] .message-bubble {
  padding: calc(var(--space-3) * 1.25) calc(var(--space-4) * 1.25);
}

/* Groups spacing */
[data-quiet="true"] .groups-grid,
[data-quiet-mode="true"] .groups-grid {
  gap: calc(var(--space-4) * 1.25);
}

[data-quiet="true"] .group-card,
[data-quiet-mode="true"] .group-card {
  padding: calc(var(--space-4) * 1.25);
}

/* Profile spacing */
[data-quiet="true"] .profile-header,
[data-quiet-mode="true"] .profile-header {
  padding: calc(var(--space-5) * 1.25);
}

/* Lounge spacing */
[data-quiet="true"] .lounge-feed,
[data-quiet-mode="true"] .lounge-feed {
  gap: calc(var(--space-5) * 1.25);
}

[data-quiet="true"] .lounge-post,
[data-quiet-mode="true"] .lounge-post {
  padding: calc(var(--space-4) * 1.25);
}

/* Journal spacing */
[data-quiet="true"] .journal-editor textarea,
[data-quiet-mode="true"] .journal-editor textarea {
  padding: calc(var(--space-5) * 1.25);
  line-height: 1.8;  /* More vertical rhythm in long-form content */
}

/* ========================================
   QUIET MODE: SHADOW REDUCTION
   Remove visual noise, not colors
   ======================================== */

[data-quiet="true"] .card,
[data-quiet="true"] .panel,
[data-quiet="true"] .surface,
[data-quiet-mode="true"] .card,
[data-quiet-mode="true"] .panel,
[data-quiet-mode="true"] .surface {
  box-shadow: none;
}

[data-quiet="true"] .group-card:hover,
[data-quiet-mode="true"] .group-card:hover {
  box-shadow: none;
  transform: none;
}

/* ========================================
   QUIET MODE: ACTION OPACITY REDUCTION
   Make actions feel less urgent
   ======================================== */

[data-quiet="true"] .post-actions,
[data-quiet="true"] .lounge-post-actions,
[data-quiet-mode="true"] .post-actions,
[data-quiet-mode="true"] .lounge-post-actions {
  opacity: 0.7;
}

[data-quiet="true"] .post-actions:hover,
[data-quiet="true"] .lounge-post-actions:hover,
[data-quiet-mode="true"] .post-actions:hover,
[data-quiet-mode="true"] .lounge-post-actions:hover {
  opacity: 1;
}

/* ==================================================
   QUIET MODE V2: METRICS HIDING
   Hide engagement counts when quietMetrics is enabled
   ================================================== */

[data-quiet-metrics="true"] .post-metrics,
[data-quiet-metrics="true"] .reaction-count,
[data-quiet-metrics="true"] .reply-count,
[data-quiet-metrics="true"] .like-count,
[data-quiet-metrics="true"] .view-count,
[data-quiet-metrics="true"] .share-count,
[data-quiet-metrics="true"] .comment-count {
  opacity: var(--opacity-muted, 0.55);
  font-size: 0;
  width: 0;
  overflow: hidden;
  transition: all var(--motion-normal, 180ms) var(--motion-ease, ease);
}

/* Reveal metrics on hover for accessibility */
[data-quiet-metrics="true"] .post-actions:hover .post-metrics,
[data-quiet-metrics="true"] .post-actions:hover .reaction-count,
[data-quiet-metrics="true"] .post-actions:hover .reply-count,
[data-quiet-metrics="true"] .post-actions:hover .like-count,
[data-quiet-metrics="true"] .post-actions:hover .comment-count {
  opacity: 1;
  font-size: inherit;
  width: auto;
}

/* Notification badges muted (no pulse) */
[data-quiet-metrics="true"] .notification-badge,
[data-quiet-metrics="true"] .unread-count {
  animation: none !important;
  opacity: var(--opacity-soft, 0.75);
}

/* ==================================================
   QUIET MODE V2: WRITING FOCUS
   Distraction-free space for journaling and posts
   ================================================== */

[data-quiet-writing="true"] .journal-editor,
[data-quiet-writing="true"] .post-composer {
  /* Narrower text column for readability */
  max-width: 680px;
  margin-left: auto;
  margin-right: auto;
}

[data-quiet-writing="true"] .journal-editor textarea,
[data-quiet-writing="true"] .post-composer textarea {
  line-height: var(--line-height-writing, 1.85);
  padding: calc(var(--space-5, 30px) * 1.3);
  font-size: 1.05rem;
}

/* Hide social feedback while writing */
[data-quiet-writing="true"] .journal-editor .post-metrics,
[data-quiet-writing="true"] .journal-editor .reaction-preview,
[data-quiet-writing="true"] .post-composer .engagement-preview {
  display: none;
}

/* Hide profile links inside journal view */
[data-quiet-writing="true"] .journal-view .user-link,
[data-quiet-writing="true"] .journal-view .profile-link {
  pointer-events: none;
  color: inherit;
  text-decoration: none;
}

/* Softer cursor/caret */
[data-quiet-writing="true"] textarea,
[data-quiet-writing="true"] [contenteditable="true"] {
  caret-color: var(--text-secondary, #888);
}

/* ==================================================
   QUIET MODE V2: VISUAL CALM
   Reduce motion, visual noise, and urgency
   ================================================== */

[data-quiet-visuals="true"] .btn-primary {
  box-shadow: none;
  filter: saturate(0.9);
}

/* Replace shadows with borders */
[data-quiet-visuals="true"] .card,
[data-quiet-visuals="true"] .panel {
  box-shadow: none;
  border: 1px solid var(--border-subtle, rgba(127, 127, 127, 0.15));
}

/* Disable decorative motion */
[data-quiet-visuals="true"] .pulse,
[data-quiet-visuals="true"] .bounce,
[data-quiet-visuals="true"] .shake,
[data-quiet-visuals="true"] .wiggle {
  animation: none !important;
}

/* Reduce hover transforms */
[data-quiet-visuals="true"] button:hover,
[data-quiet-visuals="true"] a:hover,
[data-quiet-visuals="true"] .card:hover {
  transform: none;
}

/* Soften CTAs */
[data-quiet-visuals="true"] .btn-primary:hover,
[data-quiet-visuals="true"] .btn-submit:hover {
  transform: none;
  box-shadow: none;
}



/* ==================================================
   QUIET MODE V2: HIDE METRICS
   Reduce comparison anxiety by hiding engagement counts
   ================================================== */

/* Hide reaction counts */
[data-quiet-metrics="true"] .reaction-count {
  display: none !important;
}

/* Hide like counts */
[data-quiet-metrics="true"] .like-count,
[data-quiet-metrics="true"] .likes-count {
  display: none !important;
}

/* Hide comment counts in action buttons */
[data-quiet-metrics="true"] .action-btn .action-text {
  /* Only show the action name, not the count */
}

/* Hide post stats section */
[data-quiet-metrics="true"] .post-stats {
  display: none !important;
}

/* Hide share counts */
[data-quiet-metrics="true"] .share-count,
[data-quiet-metrics="true"] .shares-count {
  display: none !important;
}

/* Hide view counts */
[data-quiet-metrics="true"] .view-count,
[data-quiet-metrics="true"] .views-count {
  display: none !important;
}

/* Hide follower/following counts on profiles */
[data-quiet-metrics="true"] .follower-count,
[data-quiet-metrics="true"] .following-count,
[data-quiet-metrics="true"] .profile-stats .stat-value {
  display: none !important;
}

/* Show placeholder text instead of counts */
[data-quiet-metrics="true"] .profile-stats .stat-label::after {
  content: " (hidden)";
  font-size: 0.75em;
  opacity: 0.5;
}

/* Hide trending numbers */
[data-quiet-metrics="true"] .trending-count,
[data-quiet-metrics="true"] .trending-number {
  display: none !important;
}

/* Hide notification counts in badges */
[data-quiet-metrics="true"] .notification-count,
[data-quiet-metrics="true"] .unread-count {
  display: none !important;
}

/* Soften the visual weight of engagement areas */
[data-quiet-metrics="true"] .post-actions {
  opacity: 0.8;
}

/* Hide reply counts in comments */
[data-quiet-metrics="true"] .reply-count {
  display: none !important;
}

/* Hide "X people reacted" text */
[data-quiet-metrics="true"] .reaction-summary {
  display: none !important;
}

/* ==================================================
   NOTIFICATION SYSTEM: CALM-FIRST COMPLIANCE
   Per notification system canonical implementation spec
   ================================================== */

/* Disable ALL animations on notification badges in Quiet Mode */
[data-quiet="true"] .notification-badge,
[data-quiet="true"] .nav-badge,
[data-quiet="true"] .unread-dot {
  animation: none !important;
  transition: none !important;
}

/* Softer badge colors in Quiet Mode (no urgency red) */
[data-quiet="true"] .notification-badge {
  background: var(--accent-primary, #7c5cff) !important;
  box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.1) !important;
}

/* Soften unread indicator dot */
[data-quiet="true"] .unread-dot {
  background: var(--accent-primary, #7c5cff) !important;
  opacity: 0.8;
}

/* Notification dropdown - calmer styling */
[data-quiet="true"] .notification-dropdown {
  border-color: var(--border-light) !important;
}

/* Unread items - subtle highlight only */
[data-quiet="true"] .notification-item.unread {
  background: var(--color-surface-hover, rgba(124, 92, 255, 0.05)) !important;
}

/* Quiet Visuals: Additional motion reduction */
[data-quiet-visuals="true"] .notification-bell .bell-button:hover {
  transform: none !important;
}

[data-quiet-visuals="true"] .notification-item {
  transition: background-color 0.15s ease !important;
}